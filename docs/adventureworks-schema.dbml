// AdventureWorks Data Warehouse Schema
// Use at https://dbdiagram.io/

Project AdventureWorks_DWH {
  database_type: 'DuckDB'
  Note: '''
    # AdventureWorks Enterprise Data Warehouse
    Schema: PROD.COMMON
    Created: 2026-01-27
  '''
}

//// =============================================
//// FACT TABLES
//// =============================================

Table fct_adventureworks_internet_sales {
  fct_adventureworks_internet_sales_pk varchar [pk, note: 'Primary key - surrogate key']
  sales_order_detail_id integer [not null, note: 'Natural key - line item ID']
  sales_order_id integer [not null, note: 'Order header ID']
  
  // Date Foreign Keys (3 date roles)
  order_date_key integer [not null, ref: > dim_date.date_key, note: 'Order date']
  due_date_key integer [not null, ref: > dim_date.date_key, note: 'Due date']
  ship_date_key integer [not null, ref: > dim_date.date_key, note: 'Ship date']
  
  // Dimension Foreign Keys
  dim_adventureworks_internet_customer_sk varchar [not null, ref: > dim_adventureworks_internet_customer.dim_adventureworks_internet_customer_sk]
  dim_adventureworks_product_sk varchar [not null, ref: > dim_adventureworks_product.dim_adventureworks_product_sk]
  dim_adventureworks_employee_sk varchar [not null, ref: > dim_adventureworks_employee.dim_adventureworks_employee_sk, note: 'Salesperson']
  dim_adventureworks_sales_territory_sk varchar [not null, ref: > dim_adventureworks_sales_territory.dim_adventureworks_sales_territory_sk]
  dim_adventureworks_geography_bill_sk varchar [not null, ref: > dim_adventureworks_geography.dim_adventureworks_geography_sk, note: 'Billing address']
  dim_adventureworks_geography_ship_sk varchar [not null, ref: > dim_adventureworks_geography.dim_adventureworks_geography_sk, note: 'Shipping address']
  dim_adventureworks_ship_method_sk varchar [not null, ref: > dim_adventureworks_ship_method.dim_adventureworks_ship_method_sk]
  dim_adventureworks_currency_sk varchar [not null, ref: > dim_adventureworks_currency.dim_adventureworks_currency_sk]
  
  // Natural Keys (for reference)
  customer_id integer
  product_id integer
  sales_person_id integer
  territory_id integer
  bill_to_address_id integer
  ship_to_address_id integer
  ship_method_id integer
  special_offer_id integer
  credit_card_id integer
  currency_rate_id integer
  
  // Degenerate Dimensions
  sales_order_number varchar [note: 'Order number']
  purchase_order_number varchar
  account_number varchar
  revision_number integer
  status_code varchar
  carrier_tracking_number varchar
  credit_card_approval_code varchar
  comment text
  
  // Measures - Line Level
  order_qty integer [not null, note: 'Quantity ordered']
  unit_price decimal(19,4) [not null, note: 'Unit price']
  unit_price_discount decimal(19,4) [note: 'Unit discount']
  line_total decimal(19,4) [not null, note: 'Line total amount']
  
  // Measures - Order Level
  order_sub_total decimal(19,4) [note: 'Order subtotal']
  order_tax_amount decimal(19,4) [note: 'Order tax amount']
  order_freight_amount decimal(19,4) [note: 'Order freight']
  order_total_due decimal(19,4) [note: 'Order total due']
  
  Note: 'Internet sales fact table - line item grain'
}

Table fct_adventureworks_reseller_sales {
  fct_adventureworks_reseller_sales_pk varchar [pk, note: 'Primary key - surrogate key']
  sales_order_detail_id integer [not null, note: 'Natural key - line item ID']
  sales_order_id integer [not null, note: 'Order header ID']
  
  // Date Foreign Keys (3 date roles)
  order_date_key integer [not null, ref: > dim_date.date_key, note: 'Order date']
  due_date_key integer [not null, ref: > dim_date.date_key, note: 'Due date']
  ship_date_key integer [not null, ref: > dim_date.date_key, note: 'Ship date']
  
  // Dimension Foreign Keys
  dim_adventureworks_reseller_customer_sk varchar [not null, ref: > dim_adventureworks_reseller_customer.dim_adventureworks_reseller_customer_sk]
  dim_adventureworks_product_sk varchar [not null, ref: > dim_adventureworks_product.dim_adventureworks_product_sk]
  dim_adventureworks_employee_sk varchar [not null, ref: > dim_adventureworks_employee.dim_adventureworks_employee_sk, note: 'Salesperson']
  dim_adventureworks_sales_territory_sk varchar [not null, ref: > dim_adventureworks_sales_territory.dim_adventureworks_sales_territory_sk]
  dim_adventureworks_geography_bill_sk varchar [not null, ref: > dim_adventureworks_geography.dim_adventureworks_geography_sk, note: 'Billing address']
  dim_adventureworks_geography_ship_sk varchar [not null, ref: > dim_adventureworks_geography.dim_adventureworks_geography_sk, note: 'Shipping address']
  dim_adventureworks_ship_method_sk varchar [not null, ref: > dim_adventureworks_ship_method.dim_adventureworks_ship_method_sk]
  dim_adventureworks_currency_sk varchar [not null, ref: > dim_adventureworks_currency.dim_adventureworks_currency_sk]
  
  // Natural Keys (for reference)
  customer_id integer
  product_id integer
  sales_person_id integer
  territory_id integer
  bill_to_address_id integer
  ship_to_address_id integer
  ship_method_id integer
  special_offer_id integer
  credit_card_id integer
  currency_rate_id integer
  
  // Degenerate Dimensions
  sales_order_number varchar [note: 'Order number']
  purchase_order_number varchar
  account_number varchar
  revision_number integer
  status_code varchar
  carrier_tracking_number varchar
  credit_card_approval_code varchar
  comment text
  
  // Measures - Line Level
  order_qty integer [not null, note: 'Quantity ordered']
  unit_price decimal(19,4) [not null, note: 'Unit price']
  unit_price_discount decimal(19,4) [note: 'Unit discount']
  line_total decimal(19,4) [not null, note: 'Line total amount']
  
  // Measures - Order Level
  order_sub_total decimal(19,4) [note: 'Order subtotal']
  order_tax_amount decimal(19,4) [note: 'Order tax amount']
  order_freight_amount decimal(19,4) [note: 'Order freight']
  order_total_due decimal(19,4) [note: 'Order total due']
  
  Note: 'Reseller sales fact table - line item grain'
}

//// =============================================
//// DIMENSION TABLES
//// =============================================

Table dim_date {
  date_key integer [pk, note: 'Primary key - YYYYMMDD format']
  date_value date [not null, note: 'Actual date']
  
  // Calendar attributes
  year integer [not null]
  quarter integer [not null]
  month integer [not null]
  month_name varchar [not null]
  week integer [not null]
  day_of_month integer [not null]
  day_of_week integer [not null]
  day_of_week_name varchar [not null]
  day_of_year integer [not null]
  
  // Fiscal attributes
  fiscal_year integer
  fiscal_quarter integer
  fiscal_month integer
  
  // Flags
  is_weekend boolean [not null]
  is_holiday boolean [not null]
  
  Note: 'Date dimension with calendar and fiscal attributes'
}

Table dim_adventureworks_product {
  dim_adventureworks_product_sk varchar [pk, note: 'Surrogate key']
  product_id integer [not null, unique, note: 'Natural key from source']
  
  // Product identifiers
  product_name varchar [not null, note: 'Product name']
  product_number varchar [not null, note: 'Product SKU']
  
  // Flags
  is_manufactured_in_house boolean
  is_finished_good boolean
  
  // Product attributes
  color varchar
  safety_stock_level integer
  reorder_point integer
  
  // Pricing
  standard_cost decimal(19,4)
  list_price decimal(19,4) [not null]
  
  // Physical attributes
  size varchar
  weight decimal(19,4)
  
  // Manufacturing
  days_to_manufacture integer
  
  // Classification
  product_line_code varchar
  class_code varchar
  style_code varchar
  
  // Category hierarchy
  product_subcategory_id integer
  product_subcategory_name varchar
  product_category_id integer
  product_category_name varchar
  
  // Model
  product_model_id integer
  product_model_name varchar
  
  // Dates
  sell_start_date date [not null]
  sell_end_date date
  discontinued_date date
  
  Note: 'Product dimension with category hierarchy'
}

Table dim_adventureworks_internet_customer {
  dim_adventureworks_internet_customer_sk varchar [pk, note: 'Surrogate key']
  customer_id integer [not null, unique, note: 'Natural key from source']
  
  // Person attributes
  title varchar
  first_name varchar [not null]
  middle_name varchar
  last_name varchar [not null]
  suffix varchar
  
  // Demographics
  birth_date date
  marital_status varchar
  gender varchar
  education varchar
  occupation varchar
  
  // Contact
  email_address varchar
  phone varchar
  
  // Customer attributes
  yearly_income decimal(19,4)
  total_children integer
  number_children_at_home integer
  number_cars_owned integer
  home_owner_flag boolean
  
  // Dates
  date_first_purchase date
  commute_distance varchar
  
  Note: 'Internet/online customer dimension'
}

Table dim_adventureworks_reseller_customer {
  dim_adventureworks_reseller_customer_sk varchar [pk, note: 'Surrogate key']
  customer_id integer [not null, unique, note: 'Natural key - customer']
  store_id integer [not null, note: 'Natural key - store']
  
  // Person attributes (contact)
  title varchar
  first_name varchar
  middle_name varchar
  last_name varchar
  suffix varchar
  
  // Store attributes
  store_name varchar [not null, note: 'Store/reseller name']
  store_number varchar
  business_type varchar
  
  // Business classification
  annual_sales decimal(19,4)
  annual_revenue decimal(19,4)
  bank_name varchar
  number_employees integer
  
  // Specialty
  specialty varchar
  square_footage integer
  brands_carried varchar
  
  // Demographics
  year_opened integer
  
  Note: 'Reseller customer dimension with store information'
}

Table dim_adventureworks_employee {
  dim_adventureworks_employee_sk varchar [pk, note: 'Surrogate key']
  employee_id integer [not null, unique, note: 'Natural key from source']
  
  // Person attributes
  title varchar
  first_name varchar [not null]
  middle_name varchar
  last_name varchar [not null]
  suffix varchar
  
  // Job attributes
  national_id_number varchar [not null]
  job_title varchar [not null]
  organization_level integer
  organization_node varchar
  
  // Demographics
  birthday date
  hire_date date [not null]
  marital_status varchar
  gender varchar
  
  // Employment
  is_salaried boolean
  is_active boolean
  vacation_hours_remaining integer
  sick_leave_hours_remaining integer
  
  Note: 'Employee/salesperson dimension'
}

Table dim_adventureworks_geography {
  dim_adventureworks_geography_sk varchar [pk, note: 'Surrogate key']
  address_id integer [not null, unique, note: 'Natural key from source']
  
  // Foreign keys
  state_province_id integer
  territory_id integer
  
  // Address
  address_line_1 varchar [not null]
  address_line_2 varchar
  city varchar [not null]
  postal_code varchar [not null]
  
  // Geographic hierarchy
  state_province_code varchar
  state_province_name varchar
  country_region_code varchar [not null]
  country_name varchar [not null]
  
  // Location
  geo_longitude decimal(9,6)
  geo_latitude decimal(9,6)
  
  Note: 'Address/location dimension with geographic hierarchy'
}

Table dim_adventureworks_sales_territory {
  dim_adventureworks_sales_territory_sk varchar [pk, note: 'Surrogate key']
  territory_id integer [not null, unique, note: 'Natural key from source']
  
  // Territory attributes
  territory_name varchar [not null, note: 'Territory name']
  territory_group varchar [not null, note: 'Territory group/region']
  country_region_code varchar [not null]
  
  // Metrics (SCD Type 2 tracked)
  cost_last_year decimal(19,4)
  cost_ytd decimal(19,4)
  sales_last_year decimal(19,4)
  sales_ytd decimal(19,4)
  
  Note: 'Sales territory dimension with metrics'
}

Table dim_adventureworks_ship_method {
  dim_adventureworks_ship_method_sk varchar [pk, note: 'Surrogate key']
  ship_method_id integer [not null, unique, note: 'Natural key from source']
  
  // Ship method attributes
  ship_method_name varchar [not null, note: 'Shipping method name']
  ship_base varchar [not null, note: 'Base shipping rate']
  ship_rate varchar [not null, note: 'Per-unit shipping rate']
  
  Note: 'Shipping method dimension'
}

Table dim_adventureworks_currency {
  dim_adventureworks_currency_sk varchar [pk, note: 'Surrogate key']
  currency_rate_id integer [not null, unique, note: 'Natural key from source']
  
  // Currency attributes
  currency_rate_date date [not null, note: 'Exchange rate date']
  from_currency_code varchar [not null, note: 'Source currency']
  to_currency_code varchar [not null, note: 'Target currency']
  
  // Exchange rates
  average_rate decimal(19,10) [not null, note: 'Average exchange rate']
  end_of_day_rate decimal(19,10) [not null, note: 'End of day rate']
  
  Note: 'Currency rate dimension'
}

//// =============================================
//// TABLE GROUPS (for visualization)
//// =============================================

TableGroup fact_tables {
  fct_adventureworks_internet_sales
  fct_adventureworks_reseller_sales
}

TableGroup customer_dimensions {
  dim_adventureworks_internet_customer
  dim_adventureworks_reseller_customer
}

TableGroup core_dimensions {
  dim_date
  dim_adventureworks_product
  dim_adventureworks_employee
  dim_adventureworks_sales_territory
}

TableGroup reference_dimensions {
  dim_adventureworks_geography
  dim_adventureworks_ship_method
  dim_adventureworks_currency
}
